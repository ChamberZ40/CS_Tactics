# CS战术板 - 多人协作版

一个专为《反恐精英》(CS)战术规划设计的在线协作工具。

## 📋 目录

- [功能特性](#功能特性)
- [部署说明](#部署说明)
- [项目结构](#项目结构)
- [使用说明](#使用说明)
- [管理员功能详解](#管理员功能详解)
- [GitHub Pages 部署指南](#github-pages-部署指南)
- [技术栈](#技术栈)
- [浏览器兼容性](#浏览器兼容性)
- [开发者说明](#开发者说明)
- [贡献指南](#贡献指南)
- [许可证](#许可证)

## 功能特性

- 🗺️ **实时多人协作** - 支持多用户同时在线编辑战术
- 🎮 **管理员权限控制** - admin用户拥有编辑权限，其他用户只能观看
- 👥 **用户管理功能** - admin可以踢出其他用户，实时同步通知
- 🗺️ **多地图支持** - 内置 de_dust2、de_mirage、de_inferno 地图
- 🔧 **丰富绘制工具** - T/CT队员标记、画线、手雷道具等
- 📱 **响应式设计** - 完美适配桌面端和移动端
- ⚡ **HTML5 Canvas** - 高性能绘制引擎

## 部署说明

### 本地开发
```bash
# 启动本地服务器（推荐）
python -m http.server 8000
# 或使用 Node.js
npx serve .

# 访问 http://localhost:8000
```

### 快速部署

1. **推送代码到GitHub仓库**
2. **启用GitHub Pages**
   - 进入仓库设置 > Pages
   - 选择部署分支（通常是main或gh-pages）
   - 选择根目录作为源码目录

3. **重要注意事项**
   - ✅ 所有文件路径已采用相对路径，支持子目录部署
   - ✅ 包含生产环境优化脚本，自动禁用调试输出
   - ⚠️ 确保所有文件名大小写正确（GitHub Pages区分大小写）
   - ⚠️ 地图文件确保在 `maps/` 目录下且文件名正确

## 项目结构

```
cs/
├── index.html          # 主页面
├── script.js          # 核心功能脚本
├── realtime.js        # 实时同步模块
├── style.css          # 样式文件
├── production-optimize.js  # 生产环境优化
├── maps/              # 地图资源
│   ├── de_dust2.jpg
│   ├── de_mirage.jpg
│   └── de_inferno.jpg
└── README.md          # 说明文档
```

## 使用说明

1. **进入战术室**
   - 输入用户名（使用"admin"获得管理员权限）
   - 点击"进入战术室"

2. **管理功能（仅限admin）**
   - 管理员可使用所有绘制工具
   - 可以切换地图和清空画布
   - **用户管理**: 可以踢出其他用户（点击用户列表中的"踢出"按钮）
   - 观看者只能移动视角和导出图片
   - 支持多种绘制工具：队员标记、画线、手雷道具等

3. **多人协作**
   - 支持多用户同时在线
   - 实时同步所有操作
   - 用户加入/离开实时通知

## 管理员功能详解

### 📋 功能概述
- **管理员权限**: 只有用户名为"admin"的用户才能看到和使用删除功能
- **删除按钮**: 在用户列表中，admin用户可以看到其他用户旁边的"踢出"按钮
- **安全机制**: admin用户不能删除自己，防止误操作
- **实时同步**: 用户被踢出后，所有在线用户都会收到通知

### 🎯 功能特点

#### 1. 权限控制
- ✅ 只有admin用户可以看到删除按钮
- ✅ 非admin用户无法执行删除操作
- ✅ admin用户不能删除自己

#### 2. 用户界面
- ✅ 用户列表显示用户角色（管理员/观看者）
- ✅ 管理员可以看到红色的"踢出"按钮
- ✅ 删除前有确认对话框，防止误操作

#### 3. 实时通知
- ✅ 被踢出的用户会收到通知并自动返回登录界面
- ✅ 其他用户会收到某用户被踢出的通知
- ✅ 用户列表实时更新

### 🧪 测试步骤

#### 1. 基础功能测试
1. 使用"admin"用户名登录
2. 打开用户列表，应该能看到：
   - 自己显示为"管理员"角色
   - 其他用户显示为"观看者"角色
   - 其他用户旁边有红色"踢出"按钮
   - 自己旁边没有删除按钮

#### 2. 删除功能测试
1. 点击某个用户的"踢出"按钮
2. 确认弹出确认对话框
3. 点击确认后：
   - 该用户从列表中消失
   - 显示成功通知
   - 如果该用户在线，会收到被踢出通知

#### 3. 权限控制测试
1. 使用非"admin"用户名登录
2. 打开用户列表，应该：
   - 看不到任何删除按钮
   - 显示为"观看者"角色

#### 4. 多用户同步测试
1. 开启多个浏览器标签页
2. 一个使用admin登录，其他使用普通用户登录
3. admin踢出某个用户
4. 所有标签页都应该收到相应通知并更新列表

### 🎨 界面变化

#### 用户列表新增元素：
- **角色标识**: 每个用户显示"管理员"或"观看者"标签
- **删除按钮**: 红色"踢出"按钮（仅admin可见）
- **更好的布局**: 支持角色显示和按钮的弹性布局

#### 样式特点：
- 管理员角色：红色标签
- 观看者角色：灰色标签
- 删除按钮：红色，有悬停效果
- 响应式设计：在小屏幕上也能正常显示

### 📱 移动端适配
- ✅ 删除按钮在移动端正常显示
- ✅ 确认对话框在移动端可用
- ✅ 通知系统在移动端正常工作

### 🔒 安全特性
- ✅ 前端权限验证（admin检查）
- ✅ 防止自我删除
- ✅ 确认对话框防误操作
- ✅ 实时广播确保数据同步

### 🐛 注意事项
1. 当前实现基于localStorage，重新加载页面后被踢出的用户可以重新进入
2. 在真实项目中应该配合后端权限验证
3. 建议在生产环境中记录管理操作日志

### 🚀 后续优化建议
1. 添加踢出原因选择
2. 添加临时禁入功能（时间限制）
3. 添加管理员操作日志
4. 支持批量管理操作
5. 集成真实的后端用户管理系统

## GitHub Pages 部署指南

### 📋 部署前检查

#### 1. 文件路径检查
- [ ] 所有CSS/JS引用使用相对路径 (已完成 ✅)
- [ ] 地图文件路径使用 `maps/` 相对路径 (已完成 ✅)
- [ ] 没有以 `/` 开头的绝对路径引用

#### 2. 文件名大小写检查
- [ ] 检查 `maps/de_dust2.jpg` 文件存在且大小写正确
- [ ] 检查 `maps/de_mirage.jpg` 文件存在且大小写正确  
- [ ] 检查 `maps/de_inferno.jpg` 文件存在且大小写正确
- [ ] 所有HTML/CSS/JS文件名大小写与引用一致

#### 3. 生产优化检查
- [ ] 已添加 `production-optimize.js` 文件 (已完成 ✅)
- [ ] HTML中已引入生产优化脚本 (已完成 ✅)
- [ ] 生产环境自动禁用console输出 (已完成 ✅)

#### 4. 跨域和安全检查
- [ ] 使用HTTPS访问GitHub Pages
- [ ] localStorage功能在HTTPS下正常工作
- [ ] 没有违反CSP（内容安全政策）的代码

### 🚀 部署步骤

#### 1. 推送到GitHub
```bash
git add .
git commit -m "优化GitHub Pages部署兼容性"
git push origin main
```

#### 2. 启用GitHub Pages
1. 进入仓库 Settings > Pages
2. 选择 Source: Deploy from a branch
3. 选择分支: main
4. 选择文件夹: / (root)
5. 点击 Save

#### 3. 访问测试
- 等待部署完成（通常1-5分钟）
- 访问 `https://username.github.io/repository-name`
- 强制刷新页面测试 (Ctrl+F5)

### 🐛 常见问题排查

#### 问题1: 页面显示但地图不加载
```
可能原因：
- 地图文件路径大小写问题
- 地图文件未正确上传

排查步骤：
1. 检查浏览器开发者工具 Network 选项卡
2. 查看是否有404错误
3. 确认maps/目录和图片文件都已上传
4. 检查文件名大小写是否完全匹配
```

#### 问题2: JavaScript功能异常
```
可能原因：
- CSP阻止内联脚本
- CORS问题
- localStorage被阻止

排查步骤：
1. 打开浏览器开发者工具 Console
2. 查看是否有错误信息
3. 确认使用HTTPS访问
4. 检查localStorage是否可用
```

#### 问题3: 样式显示异常
```
可能原因：
- CSS文件路径问题
- 缓存问题

排查步骤：
1. 强制刷新页面 (Ctrl+F5)
2. 检查CSS文件是否正确加载
3. 确认style.css文件已上传
```

### 📝 部署后验证

#### 功能验证清单
- [ ] 页面正常加载，无404错误
- [ ] 地图图片正常显示
- [ ] 工具栏正常显示和操作
- [ ] 绘制功能正常工作
- [ ] 移动端适配正常
- [ ] 用户系统正常（输入用户名，进入房间）
- [ ] localStorage数据存储正常
- [ ] 实时同步功能正常（多标签页测试）
- [ ] 管理员删除用户功能正常

#### 性能验证
- [ ] 页面加载速度正常（<3秒）
- [ ] Canvas绘制响应流畅
- [ ] 移动端操作流畅
- [ ] 没有明显的内存泄漏

### 🔧 优化建议

#### 1. 缓存优化
- 考虑添加适当的缓存头
- 使用CDN加速静态资源

#### 2. 性能优化
- 压缩CSS/JS文件
- 优化图片大小
- 使用WebP格式图片（如果浏览器支持）

#### 3. SEO优化
- 添加适当的meta标签
- 设置正确的title和description
- 添加favicon

### 📞 技术支持

如果遇到部署问题：
1. 检查GitHub Pages状态页面
2. 查看GitHub仓库的Actions日志
3. 参考GitHub Pages官方文档
4. 检查本项目的README.md文件

## 技术栈

- **前端**: HTML5, CSS3, JavaScript (ES6+)
- **绘制**: HTML5 Canvas API
- **数据存储**: localStorage (模拟实时同步)
- **样式**: 苹果风格设计系统
- **响应式**: CSS媒体查询 + Flexbox

## 浏览器兼容性

- ✅ Chrome 60+
- ✅ Firefox 55+
- ✅ Safari 12+
- ✅ Edge 79+
- ⚠️ 不支持IE浏览器

## 开发者说明

### 文件说明
- `script.js`: 核心功能，包含绘制引擎、用户管理、权限控制
- `realtime.js`: 模拟实时同步，基于localStorage实现
- `style.css`: 响应式样式，苹果风格设计
- `production-optimize.js`: 生产环境优化，禁用调试输出

### 路径管理
所有资源文件使用相对路径，确保在不同部署环境下的兼容性：
- CSS/JS文件：直接引用文件名
- 地图图片：使用 `maps/` 相对路径
- 支持子目录部署和GitHub Pages

## 贡献指南

1. Fork 本仓库
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

## 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

---
**最后更新时间**: 2024年8月

**项目状态**: ✅ 管理员删除用户功能已完成并测试通过