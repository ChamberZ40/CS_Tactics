<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å‘˜åŠŸèƒ½è°ƒè¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f7;
        }
        .debug-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #007aff;
        }
        .success { border-left-color: #34c759; }
        .error { border-left-color: #ff3b30; }
        .warning { border-left-color: #ff9500; }
        button {
            background: #007aff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
        }
        .code {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: Monaco, monospace;
            font-size: 14px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ç®¡ç†å‘˜åˆ é™¤åŠŸèƒ½è°ƒè¯•</h1>
    
    <div class="debug-item">
        <h3>æ­¥éª¤1: æ£€æŸ¥å½“å‰ç™»å½•çŠ¶æ€</h3>
        <button onclick="checkLoginStatus()">æ£€æŸ¥ç™»å½•çŠ¶æ€</button>
        <div id="loginStatus"></div>
    </div>

    <div class="debug-item">
        <h3>æ­¥éª¤2: æ£€æŸ¥ç”¨æˆ·åˆ—è¡¨</h3>
        <button onclick="checkUserList()">æ£€æŸ¥ç”¨æˆ·åˆ—è¡¨</button>
        <div id="userListStatus"></div>
    </div>

    <div class="debug-item">
        <h3>æ­¥éª¤3: æ‰‹åŠ¨åˆ›å»ºæµ‹è¯•ç”¨æˆ·</h3>
        <button onclick="createTestUsers()">åˆ›å»ºæµ‹è¯•ç”¨æˆ·</button>
        <div id="testUsersStatus"></div>
    </div>

    <div class="debug-item">
        <h3>æ­¥éª¤4: æ£€æŸ¥åˆ é™¤æŒ‰é’®</h3>
        <button onclick="checkDeleteButtons()">æ£€æŸ¥åˆ é™¤æŒ‰é’®</button>
        <div id="deleteButtonStatus"></div>
    </div>

    <div class="debug-item">
        <h3>å¿«é€Ÿæ“ä½œ</h3>
        <button onclick="window.open('http://localhost:8080', '_blank')">æ‰“å¼€ä¸»åº”ç”¨</button>
        <button onclick="resetLocalStorage()">æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
    </div>

    <script>
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'warning';
            element.innerHTML += `<div class="debug-item ${className}">${message}</div>`;
        }

        function checkLoginStatus() {
            const statusDiv = document.getElementById('loginStatus');
            statusDiv.innerHTML = '';
            
            try {
                // æ£€æŸ¥localStorageä¸­çš„æˆ¿é—´æ•°æ®
                const roomData = localStorage.getItem('room_cs_tactics');
                if (roomData) {
                    const data = JSON.parse(roomData);
                    log('loginStatus', `âœ… æ‰¾åˆ°æˆ¿é—´æ•°æ®ï¼Œç”¨æˆ·æ•°é‡: ${data.users ? data.users.length : 0}`, 'success');
                    
                    if (data.users && data.users.length > 0) {
                        data.users.forEach(user => {
                            const isAdmin = user.name === 'admin';
                            log('loginStatus', `ğŸ‘¤ ç”¨æˆ·: ${user.name} (${isAdmin ? 'ç®¡ç†å‘˜' : 'è§‚çœ‹è€…'})`, isAdmin ? 'success' : 'info');
                        });
                    }
                } else {
                    log('loginStatus', 'âš ï¸ æ²¡æœ‰æ‰¾åˆ°æˆ¿é—´æ•°æ®ï¼Œè¯·å…ˆç™»å½•ä¸»åº”ç”¨', 'warning');
                }
            } catch (error) {
                log('loginStatus', `âŒ æ£€æŸ¥ç™»å½•çŠ¶æ€æ—¶å‡ºé”™: ${error.message}`, 'error');
            }
        }

        function checkUserList() {
            const statusDiv = document.getElementById('userListStatus');
            statusDiv.innerHTML = '';
            
            // æ¨¡æ‹Ÿæ‰“å¼€ä¸»åº”ç”¨çª—å£æ¥æ£€æŸ¥
            const mainWindow = window.open('http://localhost:8080', 'mainApp');
            
            setTimeout(() => {
                try {
                    // å°è¯•è®¿é—®ä¸»çª—å£çš„å…¨å±€å˜é‡
                    if (mainWindow.csBoard) {
                        const users = mainWindow.csBoard.users;
                        log('userListStatus', `âœ… ä¸»åº”ç”¨å·²åŠ è½½ï¼Œç”¨æˆ·æ•°é‡: ${users.size}`, 'success');
                        
                        users.forEach(user => {
                            const isAdmin = user.name === 'admin';
                            log('userListStatus', `ğŸ‘¤ ${user.name} (${isAdmin ? 'ç®¡ç†å‘˜' : 'è§‚çœ‹è€…'})`, isAdmin ? 'success' : 'info');
                        });
                    } else {
                        log('userListStatus', 'âš ï¸ ä¸»åº”ç”¨æœªå®Œå…¨åŠ è½½ï¼Œè¯·ç­‰å¾…å‡ ç§’åé‡è¯•', 'warning');
                    }
                } catch (error) {
                    log('userListStatus', `âŒ æ— æ³•è®¿é—®ä¸»åº”ç”¨: ${error.message}`, 'error');
                    log('userListStatus', 'ğŸ’¡ è¯·æ‰‹åŠ¨åœ¨ä¸»åº”ç”¨ä¸­æ£€æŸ¥ç”¨æˆ·åˆ—è¡¨', 'info');
                }
            }, 2000);
        }

        function createTestUsers() {
            const statusDiv = document.getElementById('testUsersStatus');
            statusDiv.innerHTML = '';
            
            try {
                // åˆ›å»ºæµ‹è¯•æˆ¿é—´æ•°æ®
                const testData = {
                    users: [
                        {
                            id: 'admin_' + Date.now(),
                            name: 'admin',
                            joinTime: Date.now()
                        },
                        {
                            id: 'test1_' + Date.now(),
                            name: 'test1',
                            joinTime: Date.now() + 1000
                        },
                        {
                            id: 'test2_' + Date.now(),
                            name: 'test2',
                            joinTime: Date.now() + 2000
                        }
                    ],
                    shapes: [],
                    currentMap: 'de_dust2',
                    lastUpdate: Date.now()
                };
                
                localStorage.setItem('room_cs_tactics', JSON.stringify(testData));
                log('testUsersStatus', 'âœ… æµ‹è¯•ç”¨æˆ·åˆ›å»ºæˆåŠŸï¼', 'success');
                log('testUsersStatus', 'ğŸ‘¤ admin (ç®¡ç†å‘˜)', 'success');
                log('testUsersStatus', 'ğŸ‘¤ test1 (è§‚çœ‹è€…)', 'info');
                log('testUsersStatus', 'ğŸ‘¤ test2 (è§‚çœ‹è€…)', 'info');
                log('testUsersStatus', 'ğŸ’¡ ç°åœ¨ä½¿ç”¨"admin"ç™»å½•ä¸»åº”ç”¨å³å¯çœ‹åˆ°åˆ é™¤æŒ‰é’®', 'info');
                
            } catch (error) {
                log('testUsersStatus', `âŒ åˆ›å»ºæµ‹è¯•ç”¨æˆ·å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function checkDeleteButtons() {
            const statusDiv = document.getElementById('deleteButtonStatus');
            statusDiv.innerHTML = '';
            
            // æ£€æŸ¥CSSæ ·å¼æ˜¯å¦æ­£ç¡®åŠ è½½
            const testElement = document.createElement('div');
            testElement.className = 'delete-user-btn';
            testElement.textContent = 'è¸¢å‡º';
            testElement.style.display = 'none';
            document.body.appendChild(testElement);
            
            const styles = window.getComputedStyle(testElement);
            const hasStyles = styles.backgroundColor !== 'rgba(0, 0, 0, 0)';
            
            document.body.removeChild(testElement);
            
            if (hasStyles) {
                log('deleteButtonStatus', 'âœ… åˆ é™¤æŒ‰é’®CSSæ ·å¼æ­£å¸¸', 'success');
            } else {
                log('deleteButtonStatus', 'âš ï¸ åˆ é™¤æŒ‰é’®CSSæ ·å¼å¯èƒ½æœªåŠ è½½', 'warning');
            }
            
            // æä¾›è°ƒè¯•ä»£ç 
            log('deleteButtonStatus', 'ğŸ’¡ åœ¨ä¸»åº”ç”¨æ§åˆ¶å°è¿è¡Œä»¥ä¸‹ä»£ç æ¥å¼ºåˆ¶æ˜¾ç¤ºåˆ é™¤æŒ‰é’®:', 'info');
            log('deleteButtonStatus', '<div class="code">csBoard.updateUsersList();</div>', 'info');
            log('deleteButtonStatus', 'æˆ–è€…æ£€æŸ¥å½“å‰ç”¨æˆ·:', 'info');
            log('deleteButtonStatus', '<div class="code">console.log("å½“å‰ç”¨æˆ·:", csBoard.currentUser.name);</div>', 'info');
        }

        function resetLocalStorage() {
            localStorage.clear();
            alert('âœ… æ‰€æœ‰æœ¬åœ°æ•°æ®å·²æ¸…é™¤ï¼è¯·é‡æ–°ç™»å½•ã€‚');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(checkLoginStatus, 500);
        });
    </script>
</body>
</html>